# XAI_turbulentchannel_3d

Optimized version of XAI_TurbulentChannel_optimized
_____________________________________________________________________________
GUIDE TO USE THE SOLVER FOR THE EXPLAINABLE DEEP LEARNING METHODOLOGY OF THE TURBULENT CHANNEL                                                       
____________________________________________________________________________

1.  Edit the definition files for the case of the calculation in the configuration folder:
	- channel_data.py    : data for the channel parameters
	- folders.py         : name of the files and folders for the software
	- stats_data.py      : parameters for calculating the statistics of the 
	                       flow
	- training_data.py   : parameters for the training
	                       NOTE: The original training was performed for a total of 32
							     filters in the first convolution (nfil=32) 
	- evaluate_data.py   : parameters for evaluating the model
	- shap_data.py       : parameters for calculating the shap values
	- stats_data_shap.py : parameters for calculating the statistics of the
	                       SHAP values
	
2.  Evaluate the statistics of the flow to calculate the mean, rms and 
    normalization:
	- Use the file main_statistics.py to calculate them.
	
3.  Create the database for the training process:
	- Use the file prepare_tfrecords.py for calculating the TFRecords
	  required for the training algorithm. TFRecords allow the efficient
	  memory usage during the training.

4.  Train the model using tensorflow:
	- Use the file main_CNN.py for the training of the model.
	
5.  Once the model is trained evaluate the errors generated by the model:
    - Use the file plot_training_epoch.py for plotting the evolution of 
	  the training.
	- Use the file calc_pred_error.py for calculating the error of the
	  prediction.
	- Use the file plot_predictions.py for plotting the prediction of the 
	  field.
	  
6.  Calculate the SHAP values in the domain using the GradientExplainer:
	- Use the file main_SHAP.py to calculate the SHAP values of the domain
	- Original calculates with 10 repetition (nrep_field=10)
	
7.  Evaluate the number of translations of the domain required for smoothing
    the solution. Note that for this repo the SHAP values of the paper are
	used in order to plot a proper field (the training is minimum and the 
	SHAPs are not properly calculated).
	- plot_shaps_noise.py for visual representation of the noise.
	- shap_check_repetitions.py for calculate signal-to-noise ratio.
	
8.  Evaluate the statistics of the SHAP field to calculate the mean, rms and 
    normalization:
	- Use the file main_statisticsSHAP.py to calculate them.
	
9.  Percolate the SHAP-based structures with the statistics calculated in 
    step 7.
    - Use the file main_percolation_shapstruc_range.py for calculating the 
	  percolation in the range of fields and the percolation indices specified
	  in stats_data_shap.py

10. Calculate the SHAP-based structures:
	- Use the file create_SHAPstruc_dataset.py for detecting the structures
	  and extracting their characteristics.

11. Plot the SHAP-based structures as a function of the wall distance.
	- Use the plot_shap_3d.py for plotting the 3D structures. The folder in which the
	  structures are read is changed adding "_real" to use the real structures calculated
	  in the article.
	
12. Plot the other coherent structures as a function of the wall distance
	- Use the plot_uv_3d.py for plotting Q events.
	- Use the plot_streak_3d.py for plotting streaks.
	- Use the plot_chong_3d.py for plotting the chong vortices.
	
13. Calculate the jpdf of the velocity and wall-normal distance.
	- Use the plot_histuvw_shap_y_range.py for the SHAP structures. Use the "_real" folder
	  to obtain realistic results.
	- Use the plot_histuvw_uv_y_range.py for the Q events.
	- Use the plot_histuvw_streak_y_range.py for the streaks.
	- Use the plot_histuvw_chong_y_range.py for the chong vortices.
	
14. Calculate the coincidence between SHAP structures and the other types.
	- Use the calc_uv_shap_coinc_y_range.py for coincidence between SHAP 
	  structures and Q events. Use the "_real" folder to obtain realistic results.
	- Use the calc_chong_shap_coinc_y_range.py for coincidence between SHAP 
	  structures and Chong vortices. Use the "_real" folder to obtain realistic results.
	- Use the calc_streak_shap_coinc_y_range.py for coincidence between SHAP 
	  structures and streaks. Use the "_real" folder to obtain realistic results.
	- Plot all the coincidences using plot_coinc_pairs_uv_streak_chong_2_shap.py for
	  plotting the coincidence between Q events and streaks.
	  
15. Plot the visualization of the SHAP structures as black contours and the other
	coherent structures with color contours.
	- Use the function calc_Q_chong_streak_coinc_y.py to calculate the coincidence between
	  the Q events, streaks and vortices in a single field.
	- Use the function plot_Q_streak_chong_coinc_y_matrix_cont_shap.py for the whole
      domain.  Use the "_real" folder to obtain realistic results.
	- Use the function plot_Q_streak_chong_coinc_y_matrix_cont_shap_zoom.py for a 
	  reduced region.  Use the "_real" folder to obtain realistic results.
	  

-------------------------------------------------------------------------------------------------------
Note: 
-------------------------------------------------------------------------------------------------------
The dataset in data/phys has been downsampled by a factor of 3 due to the limitations in the 
repository.
